local UI = {}
UI.Flags = {}
UI.Config = {}
UI.Theme = {
    Main = Color3.fromRGB(20, 20, 20),
    Secondary = Color3.fromRGB(30, 30, 30),
    Accent = Color3.fromRGB(255, 50, 100),
    Text = Color3.fromRGB(255, 255, 255)
}

local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

function UI:CreateWindow(config)
    local window = Instance.new("ScreenGui")
    local mainFrame = Instance.new("Frame")
    local titleBar = Instance.new("Frame")
    local titleLabel = Instance.new("TextLabel")
    local tabContainer = Instance.new("Frame")
    local contentContainer = Instance.new("Frame")
    
    window.Name = "UIWindow"
    window.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

    mainFrame.Size = UDim2.new(0, 400, 0, 300)
    mainFrame.BackgroundColor3 = self.Theme.Main
    mainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
    mainFrame.Parent = window

    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = self.Theme.Secondary
    titleBar.Parent = mainFrame

    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.TextColor3 = self.Theme.Text
    titleLabel.Text = config.Title or "UI Library"
    titleLabel.Parent = titleBar

    tabContainer.Size = UDim2.new(0, 120, 1, -30)
    tabContainer.Position = UDim2.new(0, 0, 0, 30)
    tabContainer.BackgroundColor3 = self.Theme.Secondary
    tabContainer.Parent = mainFrame

    contentContainer.Size = UDim2.new(1, -120, 1, -30)
    contentContainer.Position = UDim2.new(0, 120, 0, 30)
    contentContainer.BackgroundColor3 = self.Theme.Main
    contentContainer.Parent = mainFrame

    return {
        AddTab = function(name)
            local tabButton = Instance.new("TextButton")
            tabButton.Size = UDim2.new(1, 0, 0, 30)
            tabButton.Text = name
            tabButton.Parent = tabContainer
            
            local tabContent = Instance.new("Frame")
            tabContent.Size = UDim2.new(1, 0, 1, 0)
            tabContent.BackgroundColor3 = self.Theme.Main
            tabContent.Visible = false
            tabContent.Parent = contentContainer

            tabButton.MouseButton1Click:Connect(function()
                for _, child in pairs(contentContainer:GetChildren()) do
                    child.Visible = false
                end
                tabContent.Visible = true
            end)

            return {
                AddButton = function(btnName, callback)
                    local button = Instance.new("TextButton")
                    button.Size = UDim2.new(1, 0, 0, 30)
                    button.Text = btnName
                    button.Parent = tabContent

                    button.MouseButton1Click:Connect(callback)
                end,
                AddToggle = function(toggleName, default, callback)
                    local toggle = Instance.new("TextButton")
                    toggle.Size = UDim2.new(1, 0, 0, 30)
                    toggle.Text = toggleName
                    toggle.Parent = tabContent

                    local enabled = default
                    toggle.MouseButton1Click:Connect(function()
                        enabled = not enabled
                        callback(enabled)
                    end)
                end
            }
        end
    }
end

function UI:SaveConfig()
    local player = Players.LocalPlayer
    local configData = HttpService:JSONEncode(self.Config)
    writefile(player.Name .. "_config.json", configData)
end

function UI:LoadConfig()
    local player = Players.LocalPlayer
    if isfile(player.Name .. "_config.json") then
        self.Config = HttpService:JSONDecode(readfile(player.Name .. "_config.json"))
    end
end

function UI:ApplyTheme(theme)
    self.Theme = theme
end

return UI
